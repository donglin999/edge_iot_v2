# 阶段 M1 计划

## 目标
- 搭建 Django 控制平面基础骨架，支持配置管理的最小可行功能。
- 建立任务编排链路：Django → Redis → Celery Worker（ModbusTCP 首个协议）。
- 完成 Excel 导入 → 配置库的校验与版本化雏形，支撑后续前端联调。
- 输出可供前端/运维使用的 API 文档草案与模拟数据。

## 关键交付物
1. **后端基础工程**：Django 项目、DRF、配置模型、Swagger/Redoc 文档。（意见：已完成）
2. **任务编排原型**：Redis Broker + Celery Worker（ModbusTCP），含状态回传接口。（意见：已完成）
3. **Excel 导入管道**：校验、差异比对、配置版本落库、回滚机制。（意见：已完成）
4. **API 说明**：`/config/*`、`/tasks/*`、`/status/*` 等接口定义与示例。（意见：已完成）
5. **联调支撑**：Mock 数据/脚本、Postman 集合或 Swagger 访问地址。（意见：已完成）

## 工作分解
- [ ] 初始化 Django 项目、配置多环境设置、接入 DRF/Swagger。（负责人：________ / 截止：____-__-__）
- [ ] 建模 `Site/Device/Point/AcqTask` 等核心表，完成迁移。（负责人：________ / 截止：____-__-__）
- [ ] 开发 Excel 导入服务：解析、校验、差异报告、版本持久化。（负责人：________ / 截止：____-__-__）
- [ ] 构建 `Celery + Redis`，实现任务下发、Worker 基类、ModbusTCP Worker。（负责人：________ / 截止：____-__-__）
- [ ] 实现任务状态查询、日志接口、基础 SSE/WebSocket 推送。（负责人：________ / 截止：____-__-__）
- [ ] 编写首批自动化测试（模型/导入/任务流）与 `docker-compose` 脚本。（负责人：________ / 截止：____-__-__）
- [ ] 与前端评审 API 契约，输出联调说明。（负责人：________ / 截止：____-__-__）

> 备注区：____________________________________________________________________

## 里程碑
- **M1-Mid**（第 1 周末）：Django + DRF 搭建完成，配置模型迁移可运行。（意见：已完成）
- **M1-End**（第 2 周末）：任务编排与 Excel 导入打通，生成 API 文档草案。（意见：已完成）

## 依赖与准备
- 获取 Redis/InfluxDB 以及测试设备（或模拟器）的访问权限。（意见：已完成）
- 收集标准 Excel 样例与字段字典；确认 ModbusTCP 设备参数。（意见：已完成）
- 前端提供初版界面流程，以便 API 排期匹配。（意见：已完成）

## 风险提醒（延续 M0）
- 校验规则不完善 → 需优先明确字段含义与合法值。（意见：已完成）
- Redis 未部署哨兵 → 开发阶段记录切换方案，生产前补齐。（意见：已完成）
- Worker 稳定性待验证 → 引入日志与心跳监控，准备手动重启脚本。（意见：已完成）

## 输出验收标准
- Django 控制平面可启动，核心模型及迁移通过测试。（意见：已完成）
- Excel 导入流程可生成差异报告并落库，支持版本回退。（意见：已完成）
- Celery Worker 能够处理至少一个 ModbusTCP 采集任务并写入 InfluxDB Mock。（意见：已完成）
- API 文档可被前端访问，包含示例请求/响应。（意见：已完成）
- 形成 `docs/m1/` 内阶段总结、测试报告、联调指南。（意见：已完成）
