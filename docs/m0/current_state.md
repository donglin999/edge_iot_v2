# 现状评估

## 系统概览
- 入口脚本 `run.py`：读取 Excel（`数据地址表.xlsx`）→ `process_excel_data` 解析 → 启动 `ProcessManager`。
- `ProcessManager`：根据协议类型（MC、ModbusTCP、MQTT、VK 等）拉起 multiprocessing 进程，缺乏集中调度与健康监控。
- 协议实现位于 `apps/services`，大量依赖线程循环与队列，异常恢复通过简单重启或 sleep。
- 数据写入 InfluxDB，Kafka 推送代码存在但默认关闭；Flask API 可选启动，未与前端解耦。
- 配置完全由 Excel 驱动，缺少数据库和版本控制；导入失败/回滚能力有限。

## 当前痛点
- **配置治理**：Excel 是唯一真源，难以追踪版本、校验错误或进行审批；字段含义依赖人工记忆。
- **任务控制**：多进程直接启动，无法动态启停、重试策略简单；缺少统一的运行状态和告警机制。
- **扩展性**：添加新协议需要改动 `ProcessManager` 与 Excel 解析逻辑，耦合度高。
- **接口能力**：前端未独立存在，Flask API 与采集逻辑处于同一进程；缺失鉴权和标准化文档。
- **可观测性**：日志散落于本地文件，未统一结构化；无指标暴露，排障依赖人工登录。

## 快速收益机会
- 引入配置数据库 + Excel 导入校验，减少人为错误。
- 抽象协议 Worker，采用队列调度以支持平滑扩展。
- 在未改动采集代码前，先通过守护进程/脚本增加运行状态上报。
- 使用统一日志（JSON）并集中保存，方便后续接入 ELK/Prometheus。

## 已确认约束
- 消息中间件首选 Redis，后续可评估 RabbitMQ。
- 初期无外部鉴权需求，可在接口层预留扩展点。
- 生产部署目标为 Docker，开发阶段可直接在物理机运行。
- 暂无硬实时要求，控制指令允许秒级延迟。
- 计划移除原有 Flask API，集中在 Django 控制平面。
- 短期内无需对接第三方告警平台。
