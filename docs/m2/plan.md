# 阶段 M2 计划：前端与实时体验

## 目标
- 完善前端核心功能，实现完整的用户交互体验。
- 接入身份认证与权限管理，支持多角色访问控制。
- 构建实时通信通道，支持任务状态实时更新与告警推送。
- 完成前后端联调，确保系统在测试环境稳定运行。
- 输出可演示的端到端系统，为 M3 部署做准备。

## 关键交付物
1. **前端核心页面完善**：总览仪表盘、测点数据查询与可视化、配置管理界面优化。
2. **身份认证与权限**：用户登录、JWT/Session 管理、角色权限控制（管理员/运维/观察者）。
3. **实时通信**：SSE 或 WebSocket 实现任务状态推送、告警通知。
4. **数据可视化**：InfluxDB 数据查询与曲线图展示（ECharts/Chart.js）。
5. **错误处理与用户体验**：统一错误提示、加载状态、重试机制。
6. **联调与测试**：前后端集成测试、用户体验测试、性能基准测试。

---

## 工作分解（请在"是否执行"列标注决策）

### 1. 前端核心页面完善

| 编号 | 任务描述 | 工作量估算 | 优先级 | 是否执行 | 备注 |
|------|---------|-----------|--------|---------|------|
| M2-F1.1 | 优化任务总览页面：增加任务状态卡片、健康度指标、快速操作入口 | 2 天 | 高 | | 当前页面较简单，需要增强信息密度 |
| M2-F1.2 | 实现测点数据查询页面：支持时间范围选择、测点筛选、数据表格展示 | 3 天 | 高 | | 需要对接 InfluxDB 查询 API |
| M2-F1.3 | 集成数据可视化组件：使用 ECharts 或 Recharts 展示测点数据曲线 | 2 天 | 高 | | 曲线图是核心需求 |
| M2-F1.4 | 完善配置管理页面：设备/测点详情查看、编辑功能、批量操作 | 3 天 | 中 | | 当前仅有列表，需增加编辑能力 |
| M2-F1.5 | 优化导入作业页面：增加导入历史列表、详细日志查看、回滚功能 | 2 天 | 中 | | 补充导入作业的完整生命周期管理 |
| M2-F1.6 | 添加总览仪表盘（Dashboard）：系统概览、告警统计、实时状态 | 3 天 | 高 | | 新增页面，作为系统入口 |

### 2. 身份认证与权限管理（全部不执行，不需要身份认证）

| 编号 | 任务描述 | 工作量估算 | 优先级 | 是否执行 | 备注 |
|------|---------|-----------|--------|---------|------|
| M2-A2.1 | 后端实现 JWT 认证：登录接口、Token 签发与验证 | 2 天 | 高 | | 使用 djangorestframework-simplejwt |（全部不执行，不需要身份认证）
| M2-A2.2 | 后端实现权限模型：定义角色（管理员/运维/观察者）及权限装饰器 | 2 天 | 高 | | 基于 Django 权限系统 |（全部不执行，不需要身份认证）
| M2-A2.3 | 前端实现登录页面：用户名密码登录、Token 存储 | 1 天 | 高 | | 简单的登录表单 |（全部不执行，不需要身份认证）
| M2-A2.4 | 前端实现路由守卫：未登录跳转登录页、Token 过期刷新 | 1 天 | 高 | | 使用 React Router 实现 |（全部不执行，不需要身份认证）
| M2-A2.5 | 前端实现权限控制：按角色显示/隐藏功能按钮、菜单项 | 1 天 | 中 | | 根据用户角色动态渲染 UI |（全部不执行，不需要身份认证）
| M2-A2.6 | 实现用户管理页面：创建/编辑用户、分配角色 | 2 天 | 低 | | 可后续补充，初期手动管理 |（全部不执行，不需要身份认证）

### 3. 实时通信与状态推送

| 编号 | 任务描述 | 工作量估算 | 优先级 | 是否执行 | 备注 |
|------|---------|-----------|--------|---------|------|
| M2-R3.1 | 后端实现 SSE 接口：推送任务状态变更、采集进度 | 2 天 | 高 | | 推荐使用 SSE，实现简单 |
| M2-R3.2 | 前端集成 SSE 客户端：订阅实时事件、更新页面状态 | 1 天 | 高 | | 使用 EventSource API |
| M2-R3.3 | 后端实现告警推送机制：异常检测、告警事件生成 | 2 天 | 中 | | 需要定义告警规则 |
| M2-R3.4 | 前端实现告警通知：Toast 提示、告警列表页面 | 1 天 | 中 | | 使用通知组件库 |
| M2-R3.5 | （备选）实现 WebSocket 支持：双向通信、心跳保活 | 3 天 | 低 | | 仅在 SSE 不满足需求时实现 |
| M2-R3.6 | 实现任务日志实时输出：Celery 日志流式传输到前端 | 2 天 | 低 | | 可选功能，方便调试 |

### 4. 数据查询与可视化

| 编号 | 任务描述 | 工作量估算 | 优先级 | 是否执行 | 备注 |
|------|---------|-----------|--------|---------|------|
| M2-D4.1 | 后端实现 InfluxDB 查询接口：按时间范围、测点查询数据 | 2 天 | 高 | | 封装 InfluxDB 查询逻辑 |
| M2-D4.2 | 后端实现数据聚合接口：支持降采样、平均值/最大值/最小值查询 | 2 天 | 中 | | 大时间范围查询需要聚合 |
| M2-D4.3 | 前端实现数据表格：分页、排序、导出 CSV | 2 天 | 高 | | 基础数据展示 |
| M2-D4.4 | 前端实现曲线图：多测点对比、缩放、Tooltip | 3 天 | 高 | | 使用 ECharts 或 Recharts |
| M2-D4.5 | 前端实现时间选择器：快捷时间范围、自定义日期范围 | 1 天 | 高 | | 增强用户体验 |
| M2-D4.6 | 实现数据导出功能：导出 Excel/CSV 格式 | 1 天 | 低 | | 可选功能 |

### 5. 错误处理与用户体验优化

| 编号 | 任务描述 | 工作量估算 | 优先级 | 是否执行 | 备注 |
|------|---------|-----------|--------|---------|------|
| M2-E5.1 | 前端统一错误处理：API 错误拦截、友好提示 | 1 天 | 高 | | 使用 Axios 拦截器 |
| M2-E5.2 | 前端统一加载状态：Skeleton/Spinner 组件 | 1 天 | 高 | | 提升加载体验 |
| M2-E5.3 | 前端实现重试机制：失败请求自动/手动重试 | 1 天 | 中 | | 网络不稳定场景 |
| M2-E5.4 | 前端实现离线提示：网络断开时显示提示 | 0.5 天 | 低 | | 可选功能 |
| M2-E5.5 | 后端统一异常处理：自定义异常类、错误码规范 | 1 天 | 高 | | 已有基础，需完善 |
| M2-E5.6 | 前端响应式布局优化：支持不同屏幕尺寸 | 2 天 | 低 | | 当前主要面向桌面端 |

### 6. 联调、测试与文档

| 编号 | 任务描述 | 工作量估算 | 优先级 | 是否执行 | 备注 |
|------|---------|-----------|--------|---------|------|
| M2-T6.1 | 前后端联调：端到端功能验证、接口契约确认 | 3 天 | 高 | | 贯穿整个 M2 阶段 |
| M2-T6.2 | 编写前端单元测试：核心组件、工具函数测试 | 2 天 | 中 | | 使用 Vitest 或 Jest |
| M2-T6.3 | 编写端到端测试：关键业务流程自动化测试 | 3 天 | 中 | | 使用 Playwright 或 Cypress |
| M2-T6.4 | 性能基准测试：页面加载时间、API 响应时间 | 1 天 | 低 | | 建立性能基线 |
| M2-T6.5 | 用户体验测试：邀请实际用户试用、收集反馈 | 2 天 | 中 | | 发现易用性问题 |
| M2-T6.6 | 编写前端使用手册：用户操作指南、常见问题 | 2 天 | 中 | | 文档交付 |
| M2-T6.7 | 更新 API 文档：补充新增接口、示例代码 | 1 天 | 高 | | 保持文档同步 |

---

## 里程碑

| 里程碑 | 时间点 | 验收标准 | 是否执行 |
|--------|--------|---------|---------|
| M2-Mid | 第 1 周末 | 身份认证完成，核心页面框架搭建，SSE 原型跑通 | |
| M2-End | 第 2 周末 | 所有核心功能完成，前后端联调通过，测试环境稳定运行 | |

---

## 依赖与准备

| 依赖项 | 状态 | 负责人 | 是否执行 | 备注 |
|--------|------|--------|---------|------|
| InfluxDB 测试数据准备 | 待确认 | | | 需要有一定量的测试数据用于可视化开发 |
| 前端 UI 组件库选型 | 待确认 | | | 建议使用 Ant Design 或 Material-UI |
| 告警规则定义 | 待确认 | | | 需要明确哪些场景触发告警 |
| 用户角色与权限矩阵 | 待确认 | | | 定义各角色的具体权限范围 |

---

## 技术选型建议

| 技术点 | 推荐方案 | 备选方案 | 是否执行 | 理由 |
|--------|---------|---------|---------|------|
| 身份认证 | djangorestframework-simplejwt | Django Session | | JWT 适合前后端分离 |
| 实时通信 | SSE (Server-Sent Events) | WebSocket | | SSE 实现简单，适合单向推送 |
| 数据可视化 | ECharts | Recharts / Chart.js | | ECharts 功能强大，中文文档完善 |
| 前端状态管理 | React Context + Hooks | Redux / Zustand | | 项目规模中等，Context 足够 |
| 前端 UI 组件库 | Ant Design | Material-UI | | 组件丰富，企业级项目常用 |
| 前端测试 | Vitest + Playwright | Jest + Cypress | | Vite 生态，性能更好 |

---

## 输出验收标准

- [ ] 前端所有核心页面完成，UI/UX 符合基本可用标准。
- [ ] 用户可通过登录访问系统，不同角色权限正确生效。
- [ ] 任务状态变更可实时推送到前端，延迟 < 2 秒。
- [ ] 测点数据可查询并以曲线图展示，支持至少 1 万条数据点。
- [ ] 前后端联调无阻塞问题，核心流程可端到端跑通。
- [ ] 形成 `docs/m2/` 内阶段总结、测试报告、使用手册。

---

## 下一步行动

1. **填写"是否执行"列**：请在上述所有任务的"是否执行"列标注"执行"或"不执行"。
2. **确认技术选型**：确认推荐的技术方案或提出调整建议。
3. **分配负责人与截止日期**：明确各任务的责任人与交付时间。
4. **启动开发**：按优先级从高到低依次实施。

---

## 备注区

（请在此记录特殊说明、变更原因等）

____________________________________________________________________
____________________________________________________________________
____________________________________________________________________
